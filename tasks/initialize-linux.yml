---

- name: Add Debian based requested repositories if exists
  apt_repository:
   repo: "{{ item.repo }}"
   state: present
   update_cache: true
  with_items: "{{ __repositories }}"
  when:
   - item.os is defined
   - __repositories is defined
   - item.os == ansible_os_family or item.os == ansible_distribution
   - ansible_os_family == "Debian"
   - item.v_major == ansible_distribution_major_version

- name: Add RedHat based requested repositories if exists
  yum_repository:
   name: "{{ item.name }}"
   baseurl: "{{ item.repo }}"
   enabled: "yes"
   enablegroups: "yes"
   keepalive: "{{ item.keepalive | default('yes') }}"
   keepcache: "{{ item.keepcache | default('1') }}"
   metadata_expire: "{{ item.metadata_expire | default('21600') }}"
   password: "{{ item.password | default('') }}"
   username: "{{ item.username | default('') }}"
   timeout: "{{ item.timeout | default('30') }}"
   sslverify: "{{ item.sslverify | default('yes') }}"
   sslclientkey: "{{ item.sslclientkey | default('') }}"
   sslclientcert: "{{ item.sslclientcert | default('') }}"
   reposdir: "{{ item.reposdir | default('/etc/yum.repos.d') }}"
   state: present
  with_items: "{{ __repositories }}"
  when:
   - item.os is defined
   - __repositories is defined
   - item.os == ansible_os_family or item.os == ansible_distribution
   - ansible_os_family == "RedHat"
   - item.v_major == ansible_distribution_major_version

- name: Define installation directories for Debian family
  set_fact:
   install_dir: "/usr/lib/jvm/java-$v_major$v_minor-openjdk"
   url_7_8: "https://download.java.net/openjdk/jdk$v_majoru$v_minor/ri/openjdk-$v_majoru\
   $v_minor-b$build-$os-$arch-$date.tar.gz"
   url_9x_10: "https://download.java.net/java/GA/jdk$v_major/$v_major$v_minor/binaries/openjdk\
   -$v_major$v_minor_$os-$arch_bin.tar.gz"
   url_10x: "https://download.java.net/java/GA/jdk$v_major/$v_major$v_minor/$hash/$build/\
   openjdk-$v_major$v_minor_$os-$arch_bin.tar.gz"
   url_11: "https://download.java.net/java/ga/jdk$v_major/openjdk-$v_major_$os-$arch_bin.tar.gz"
   url_11x_12x: "https://download.java.net/java/GA/jdk$v_major/$build/GPL/openjdk-$v_major\
   $v_minor_$os-$arch_bin.tar.gz"
   alternatives:
    - 'java'
    - 'javac'
    - 'javadoc'
    - 'jar'
    - 'jarsigner'
    - 'javap'
    - 'jcmd'
    - 'jconsole'
    - 'keytool'
    - 'rmiregistry'
    - 'rmic'
    - 'rmid'
